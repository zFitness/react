{"version":3,"file":"bridge.js","mappings":";;;;;;;;;;;;;;;;AAAA;;;;;;;;IASqBA;;;;0CAC0B,IAAIC,GAAJ;;;;;gCAG3CC,OACAC,UACM;AACN,UAAMC,SAAS,GAAG,KAAKC,YAAL,CAAkBC,GAAlB,CAAsBJ,KAAtB,CAAlB;;AACA,UAAIE,SAAS,KAAKG,SAAlB,EAA6B;AAC3B,aAAKF,YAAL,CAAkBG,GAAlB,CAAsBN,KAAtB,EAA6B,CAACC,QAAD,CAA7B;AACD,OAFD,MAEO;AACL,YAAMM,KAAK,GAAGL,SAAS,CAACM,OAAV,CAAkBP,QAAlB,CAAd;;AACA,YAAIM,KAAK,GAAG,CAAZ,EAAe;AACbL,UAAAA,SAAS,CAACO,IAAV,CAAeR,QAAf;AACD;AACF;AACF;;;yBAGCD,OAEM;AACN,UAAME,SAAS,GAAG,KAAKC,YAAL,CAAkBC,GAAlB,CAAsBJ,KAAtB,CAAlB;;AACA,UAAIE,SAAS,KAAKG,SAAlB,EAA6B;AAAA,0CAH1BK,IAG0B;AAH1BA,UAAAA,IAG0B;AAAA;;AAC3B,YAAIR,SAAS,CAACS,MAAV,KAAqB,CAAzB,EAA4B;AAC1B;AACA,cAAMV,QAAQ,GAAGC,SAAS,CAAC,CAAD,CAA1B;AACAD,UAAAA,QAAQ,CAACW,KAAT,CAAe,IAAf,EAAqBF,IAArB;AACD,SAJD,MAIO;AACL,cAAIG,QAAQ,GAAG,KAAf;AACA,cAAIC,WAAW,GAAG,IAAlB;AAEA,cAAMC,eAAe,GAAGC,KAAK,CAACC,IAAN,CAAWf,SAAX,CAAxB;;AACA,eAAK,IAAIgB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,eAAe,CAACJ,MAApC,EAA4CO,CAAC,EAA7C,EAAiD;AAC/C,gBAAMjB,SAAQ,GAAGc,eAAe,CAACG,CAAD,CAAhC;;AACA,gBAAI;AACFjB,cAAAA,SAAQ,CAACW,KAAT,CAAe,IAAf,EAAqBF,IAArB;AACD,aAFD,CAEE,OAAOS,KAAP,EAAc;AACd,kBAAIL,WAAW,KAAK,IAApB,EAA0B;AACxBD,gBAAAA,QAAQ,GAAG,IAAX;AACAC,gBAAAA,WAAW,GAAGK,KAAd;AACD;AACF;AACF;;AAED,cAAIN,QAAJ,EAAc;AACZ,kBAAMC,WAAN;AACD;AACF;AACF;AACF;;;yCAE0B;AACzB,WAAKX,YAAL,CAAkBiB,KAAlB;AACD;;;mCAEcpB,OAAsBC,UAA0B;AAC7D,UAAMC,SAAS,GAAG,KAAKC,YAAL,CAAkBC,GAAlB,CAAsBJ,KAAtB,CAAlB;;AACA,UAAIE,SAAS,KAAKG,SAAlB,EAA6B;AAC3B,YAAME,KAAK,GAAGL,SAAS,CAACM,OAAV,CAAkBP,QAAlB,CAAd;;AACA,YAAIM,KAAK,IAAI,CAAb,EAAgB;AACdL,UAAAA,SAAS,CAACmB,MAAV,CAAiBd,KAAjB,EAAwB,CAAxB;AACD;AACF;AACF;;;;;;;;;;;;SCzEH;SACA;;SAEA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;;SAEA;SACA;;SAEA;SACA;SACA;;;;;UCtBA;UACA;UACA;UACA;UACA,yCAAyC,wCAAwC;UACjF;UACA;UACA;;;;;UCPA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAA;;;;;;;;AASA;AAYA,IAAMe,cAAc,GAAG,GAAvB,EAEA;AACA;AACA;;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,IAAMC,eAAsC,GAAG,CACpD;AACA;AACA;AACA;AACEC,EAAAA,OAAO,EAAE,CADX;AAEEC,EAAAA,aAAa,EAAE,WAFjB;AAGEC,EAAAA,aAAa,EAAE;AAHjB,CAJoD,EASpD;AACA;AACA;AACA;AACEF,EAAAA,OAAO,EAAE,CADX;AAEEC,EAAAA,aAAa,EAAE,QAFjB;AAGEC,EAAAA,aAAa,EAAE;AAHjB,CAZoD,EAiBpD;AACA;AACEF,EAAAA,OAAO,EAAE,CADX;AAEEC,EAAAA,aAAa,EAAE,QAFjB;AAGEC,EAAAA,aAAa,EAAE;AAHjB,CAlBoD,CAA/C;AAyBA,IAAMC,qBAAqC,GAChDJ,eAAe,CAACA,eAAe,CAACZ,MAAhB,GAAyB,CAA1B,CADV;;IAsMDiB;;;;;AAaJ,kBAAYC,IAAZ,EAAwB;AAAA;;AAAA;;AACtB;;AADsB,kEAND,KAMC;;AAAA,oEALI,EAKJ;;AAAA,iEAJO,IAIP;;AAAA,oEAFS,IAET;;AAAA,6DA0FH,YAAM;AACzB;AACA;AACA;AAEA,UAAI,MAAKC,UAAL,KAAoB,IAAxB,EAA8B;AAC5BC,QAAAA,YAAY,CAAC,MAAKD,UAAN,CAAZ;AACA,cAAKA,UAAL,GAAkB,IAAlB;AACD;;AAED,UAAI,MAAKE,aAAL,CAAmBrB,MAAvB,EAA+B;AAC7B,aAAK,IAAIO,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,MAAKc,aAAL,CAAmBrB,MAAvC,EAA+CO,CAAC,IAAI,CAApD,EAAuD;AAAA;;AACrD,+BAAKe,KAAL,EAAWC,IAAX,qBAAgB,MAAKF,aAAL,CAAmBd,CAAnB,CAAhB,4BAA0C,MAAKc,aAAL,CAAmBd,CAAC,GAAG,CAAvB,CAA1C;AACD;;AACD,cAAKc,aAAL,CAAmBrB,MAAnB,GAA4B,CAA5B,CAJ6B,CAM7B;AACA;AACA;;AACA,cAAKmB,UAAL,GAAkBK,UAAU,CAAC,MAAKC,MAAN,EAAcd,cAAd,CAA5B;AACD;AACF,KA/GuB;;AAAA,0EAmH2B,gBAMxB;AAAA,UALzBe,EAKyB,QALzBA,EAKyB;AAAA,UAJzBC,IAIyB,QAJzBA,IAIyB;AAAA,UAHzBC,UAGyB,QAHzBA,UAGyB;AAAA,UAFzBC,IAEyB,QAFzBA,IAEyB;AAAA,UADzBC,KACyB,QADzBA,KACyB;;AACzB,cAAQD,IAAR;AACE,aAAK,SAAL;AACE,gBAAKN,IAAL,CAAU,iBAAV,EAA6B;AAC3BG,YAAAA,EAAE,EAAFA,EAD2B;AAE3BC,YAAAA,IAAI,EAAJA,IAF2B;AAG3BC,YAAAA,UAAU,EAAVA,UAH2B;AAI3BG,YAAAA,YAAY,EAAE,IAJa;AAK3BD,YAAAA,KAAK,EAALA;AAL2B,WAA7B;;AAOA;;AACF,aAAK,OAAL;AACE,gBAAKP,IAAL,CAAU,mBAAV,EAA+B;AAC7BG,YAAAA,EAAE,EAAFA,EAD6B;AAE7BC,YAAAA,IAAI,EAAJA,IAF6B;AAG7BC,YAAAA,UAAU,EAAVA,UAH6B;AAI7BG,YAAAA,YAAY,EAAE,IAJe;AAK7BD,YAAAA,KAAK,EAALA;AAL6B,WAA/B;;AAOA;;AACF,aAAK,OAAL;AACE,gBAAKP,IAAL,CAAU,eAAV,EAA2B;AACzBG,YAAAA,EAAE,EAAFA,EADyB;AAEzBC,YAAAA,IAAI,EAAJA,IAFyB;AAGzBC,YAAAA,UAAU,EAAVA,UAHyB;AAIzBG,YAAAA,YAAY,EAAE,IAJW;AAKzBD,YAAAA,KAAK,EAALA;AALyB,WAA3B;;AAOA;;AACF,aAAK,OAAL;AACE,gBAAKP,IAAL,CAAU,eAAV,EAA2B;AACzBG,YAAAA,EAAE,EAAFA,EADyB;AAEzBC,YAAAA,IAAI,EAAJA,IAFyB;AAGzBC,YAAAA,UAAU,EAAVA,UAHyB;AAIzBG,YAAAA,YAAY,EAAE,IAJW;AAKzBD,YAAAA,KAAK,EAALA;AALyB,WAA3B;;AAOA;AApCJ;AAsCD,KAhKuB;;AAEtB,UAAKR,KAAL,GAAaJ,IAAb;AAEA,UAAKc,aAAL,GACEd,IAAI,CAACe,MAAL,CAAY,UAACC,OAAD,EAAsB;AAChC,UAAIA,OAAO,IAAIA,OAAO,CAAC7C,KAAvB,EAA8B;AAC5B,sCAAY8C,IAAZ,CAAiBD,OAAO,CAAC7C,KAAzB,EAAgC6C,OAAO,CAACE,OAAxC;AACD;AACF,KAJD,KAIM,IALR,CAJsB,CAWtB;AACA;AACA;;AACA,UAAKC,WAAL,CAAiB,qBAAjB,EAAwC,MAAKC,mBAA7C;;AAdsB;AAevB,IAED;AACA;;;;;yBAMEjD,OAEA;AACA,UAAI,KAAKkD,WAAT,EAAsB;AACpBC,QAAAA,OAAO,CAACC,IAAR,iCAC0BpD,KAD1B;AAGA;AACD,OAND,CAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAfA,wCADG+C,OACH;AADGA,QAAAA,OACH;AAAA;;AAgBA,WAAKf,aAAL,CAAmBvB,IAAnB,CAAwBT,KAAxB,EAA+B+C,OAA/B;;AACA,UAAI,CAAC,KAAKjB,UAAV,EAAsB;AACpB,aAAKA,UAAL,GAAkBK,UAAU,CAAC,KAAKC,MAAN,EAAc,CAAd,CAA5B;AACD;AACF;;;+BAEU;AACT,UAAI,KAAKc,WAAT,EAAsB;AACpBC,QAAAA,OAAO,CAACC,IAAR,CAAa,8BAAb;AACA;AACD,OAJQ,CAMT;;;AACA,WAAKN,IAAL,CAAU,UAAV;AACA,WAAKZ,IAAL,CAAU,UAAV,EARS,CAUT;;AACA,WAAKgB,WAAL,GAAmB,IAAnB,CAXS,CAaT;AACA;;AACA,WAAKF,WAAL,GAAmB,YAAY,CAAE,CAAjC,CAfS,CAgBT;;;AACA,WAAKF,IAAL,GAAY,YAAY,CAAE,CAA1B,CAjBS,CAkBT;AAEA;;;AACA,WAAKO,kBAAL,GArBS,CAuBT;;AACA,UAAMC,YAAY,GAAG,KAAKX,aAA1B;;AACA,UAAIW,YAAJ,EAAkB;AAChBA,QAAAA,YAAY;AACb,OA3BQ,CA6BT;AACA;;;AACA,SAAG;AACD,aAAKlB,MAAL;AACD,OAFD,QAES,KAAKJ,aAAL,CAAmBrB,MAF5B,EA/BS,CAmCT;;;AACA,UAAI,KAAKmB,UAAL,KAAoB,IAAxB,EAA8B;AAC5BC,QAAAA,YAAY,CAAC,KAAKD,UAAN,CAAZ;AACA,aAAKA,UAAL,GAAkB,IAAlB;AACD;AACF;;;wBArEgB;AACf,aAAO,KAAKG,KAAZ;AACD;;;;EA/BOnC;;AAgLV,iEAAe8B,MAAf,E","sources":["webpack://react-devtools-shared/./src/events.js","webpack://react-devtools-shared/webpack/bootstrap","webpack://react-devtools-shared/webpack/runtime/define property getters","webpack://react-devtools-shared/webpack/runtime/hasOwnProperty shorthand","webpack://react-devtools-shared/./src/bridge.js"],"sourcesContent":["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nexport default class EventEmitter<Events: Object> {\n  listenersMap: Map<string, Array<Function>> = new Map();\n\n  addListener<Event: $Keys<Events>>(\n    event: Event,\n    listener: (...$ElementType<Events, Event>) => any,\n  ): void {\n    const listeners = this.listenersMap.get(event);\n    if (listeners === undefined) {\n      this.listenersMap.set(event, [listener]);\n    } else {\n      const index = listeners.indexOf(listener);\n      if (index < 0) {\n        listeners.push(listener);\n      }\n    }\n  }\n\n  emit<Event: $Keys<Events>>(\n    event: Event,\n    ...args: $ElementType<Events, Event>\n  ): void {\n    const listeners = this.listenersMap.get(event);\n    if (listeners !== undefined) {\n      if (listeners.length === 1) {\n        // No need to clone or try/catch\n        const listener = listeners[0];\n        listener.apply(null, args);\n      } else {\n        let didThrow = false;\n        let caughtError = null;\n\n        const clonedListeners = Array.from(listeners);\n        for (let i = 0; i < clonedListeners.length; i++) {\n          const listener = clonedListeners[i];\n          try {\n            listener.apply(null, args);\n          } catch (error) {\n            if (caughtError === null) {\n              didThrow = true;\n              caughtError = error;\n            }\n          }\n        }\n\n        if (didThrow) {\n          throw caughtError;\n        }\n      }\n    }\n  }\n\n  removeAllListeners(): void {\n    this.listenersMap.clear();\n  }\n\n  removeListener(event: $Keys<Events>, listener: Function): void {\n    const listeners = this.listenersMap.get(event);\n    if (listeners !== undefined) {\n      const index = listeners.indexOf(listener);\n      if (index >= 0) {\n        listeners.splice(index, 1);\n      }\n    }\n  }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport EventEmitter from './events';\n\nimport type {ComponentFilter, Wall} from './frontend/types';\nimport type {\n  InspectedElementPayload,\n  OwnersList,\n  ProfilingDataBackend,\n  RendererID,\n  ConsolePatchSettings,\n} from 'react-devtools-shared/src/backend/types';\nimport type {StyleAndLayout as StyleAndLayoutPayload} from 'react-devtools-shared/src/backend/NativeStyleEditor/types';\n\nconst BATCH_DURATION = 100;\n\n// This message specifies the version of the DevTools protocol currently supported by the backend,\n// as well as the earliest NPM version (e.g. \"4.13.0\") that protocol is supported by on the frontend.\n// This enables an older frontend to display an upgrade message to users for a newer, unsupported backend.\nexport type BridgeProtocol = {\n  // Version supported by the current frontend/backend.\n  version: number,\n\n  // NPM version range that also supports this version.\n  // Note that 'maxNpmVersion' is only set when the version is bumped.\n  minNpmVersion: string,\n  maxNpmVersion: string | null,\n};\n\n// Bump protocol version whenever a backwards breaking change is made\n// in the messages sent between BackendBridge and FrontendBridge.\n// This mapping is embedded in both frontend and backend builds.\n//\n// The backend protocol will always be the latest entry in the BRIDGE_PROTOCOL array.\n//\n// When an older frontend connects to a newer backend,\n// the backend can send the minNpmVersion and the frontend can display an NPM upgrade prompt.\n//\n// When a newer frontend connects with an older protocol version,\n// the frontend can use the embedded minNpmVersion/maxNpmVersion values to display a downgrade prompt.\nexport const BRIDGE_PROTOCOL: Array<BridgeProtocol> = [\n  // This version technically never existed,\n  // but a backwards breaking change was added in 4.11,\n  // so the safest guess to downgrade the frontend would be to version 4.10.\n  {\n    version: 0,\n    minNpmVersion: '\"<4.11.0\"',\n    maxNpmVersion: '\"<4.11.0\"',\n  },\n  // Versions 4.11.x – 4.12.x contained the backwards breaking change,\n  // but we didn't add the \"fix\" of checking the protocol version until 4.13,\n  // so we don't recommend downgrading to 4.11 or 4.12.\n  {\n    version: 1,\n    minNpmVersion: '4.13.0',\n    maxNpmVersion: '4.21.0',\n  },\n  // Version 2 adds a StrictMode-enabled and supports-StrictMode bits to add-root operation.\n  {\n    version: 2,\n    minNpmVersion: '4.22.0',\n    maxNpmVersion: null,\n  },\n];\n\nexport const currentBridgeProtocol: BridgeProtocol =\n  BRIDGE_PROTOCOL[BRIDGE_PROTOCOL.length - 1];\n\ntype ElementAndRendererID = {id: number, rendererID: RendererID};\n\ntype Message = {\n  event: string,\n  payload: any,\n};\n\ntype HighlightElementInDOM = {\n  ...ElementAndRendererID,\n  displayName: string | null,\n  hideAfterTimeout: boolean,\n  openNativeElementsPanel: boolean,\n  scrollIntoView: boolean,\n};\n\ntype OverrideValue = {\n  ...ElementAndRendererID,\n  path: Array<string | number>,\n  wasForwarded?: boolean,\n  value: any,\n};\n\ntype OverrideHookState = {\n  ...OverrideValue,\n  hookID: number,\n};\n\ntype PathType = 'props' | 'hooks' | 'state' | 'context';\n\ntype DeletePath = {\n  ...ElementAndRendererID,\n  type: PathType,\n  hookID?: ?number,\n  path: Array<string | number>,\n};\n\ntype RenamePath = {\n  ...ElementAndRendererID,\n  type: PathType,\n  hookID?: ?number,\n  oldPath: Array<string | number>,\n  newPath: Array<string | number>,\n};\n\ntype OverrideValueAtPath = {\n  ...ElementAndRendererID,\n  type: PathType,\n  hookID?: ?number,\n  path: Array<string | number>,\n  value: any,\n};\n\ntype OverrideError = {\n  ...ElementAndRendererID,\n  forceError: boolean,\n};\n\ntype OverrideSuspense = {\n  ...ElementAndRendererID,\n  forceFallback: boolean,\n};\n\ntype CopyElementPathParams = {\n  ...ElementAndRendererID,\n  path: Array<string | number>,\n};\n\ntype ViewAttributeSourceParams = {\n  ...ElementAndRendererID,\n  path: Array<string | number>,\n};\n\ntype InspectElementParams = {\n  ...ElementAndRendererID,\n  forceFullData: boolean,\n  path: Array<number | string> | null,\n  requestID: number,\n};\n\ntype StoreAsGlobalParams = {\n  ...ElementAndRendererID,\n  count: number,\n  path: Array<string | number>,\n};\n\ntype NativeStyleEditor_RenameAttributeParams = {\n  ...ElementAndRendererID,\n  oldName: string,\n  newName: string,\n  value: string,\n};\n\ntype NativeStyleEditor_SetValueParams = {\n  ...ElementAndRendererID,\n  name: string,\n  value: string,\n};\n\ntype SavedPreferencesParams = {\n  appendComponentStack: boolean,\n  breakOnConsoleErrors: boolean,\n  componentFilters: Array<ComponentFilter>,\n  showInlineWarningsAndErrors: boolean,\n  hideConsoleLogsInStrictMode: boolean,\n};\n\nexport type BackendEvents = {\n  backendVersion: [string],\n  bridgeProtocol: [BridgeProtocol],\n  extensionBackendInitialized: [],\n  fastRefreshScheduled: [],\n  getSavedPreferences: [],\n  inspectedElement: [InspectedElementPayload],\n  isBackendStorageAPISupported: [boolean],\n  isSynchronousXHRSupported: [boolean],\n  operations: [Array<number>],\n  ownersList: [OwnersList],\n  overrideComponentFilters: [Array<ComponentFilter>],\n  profilingData: [ProfilingDataBackend],\n  profilingStatus: [boolean],\n  reloadAppForProfiling: [],\n  saveToClipboard: [string],\n  selectFiber: [number],\n  shutdown: [],\n  stopInspectingNative: [boolean],\n  syncSelectionFromNativeElementsPanel: [],\n  syncSelectionToNativeElementsPanel: [],\n  unsupportedRendererVersion: [RendererID],\n\n  // React Native style editor plug-in.\n  isNativeStyleEditorSupported: [\n    {isSupported: boolean, validAttributes: ?$ReadOnlyArray<string>},\n  ],\n  NativeStyleEditor_styleAndLayout: [StyleAndLayoutPayload],\n};\n\ntype FrontendEvents = {\n  clearErrorsAndWarnings: [{rendererID: RendererID}],\n  clearErrorsForFiberID: [ElementAndRendererID],\n  clearNativeElementHighlight: [],\n  clearWarningsForFiberID: [ElementAndRendererID],\n  copyElementPath: [CopyElementPathParams],\n  deletePath: [DeletePath],\n  getBackendVersion: [],\n  getBridgeProtocol: [],\n  getOwnersList: [ElementAndRendererID],\n  getProfilingData: [{rendererID: RendererID}],\n  getProfilingStatus: [],\n  highlightNativeElement: [HighlightElementInDOM],\n  inspectElement: [InspectElementParams],\n  logElementToConsole: [ElementAndRendererID],\n  overrideError: [OverrideError],\n  overrideSuspense: [OverrideSuspense],\n  overrideValueAtPath: [OverrideValueAtPath],\n  profilingData: [ProfilingDataBackend],\n  reloadAndProfile: [boolean],\n  renamePath: [RenamePath],\n  savedPreferences: [SavedPreferencesParams],\n  selectFiber: [number],\n  setTraceUpdatesEnabled: [boolean],\n  shutdown: [],\n  startInspectingNative: [],\n  startProfiling: [boolean],\n  stopInspectingNative: [boolean],\n  stopProfiling: [],\n  storeAsGlobal: [StoreAsGlobalParams],\n  updateComponentFilters: [Array<ComponentFilter>],\n  updateConsolePatchSettings: [ConsolePatchSettings],\n  viewAttributeSource: [ViewAttributeSourceParams],\n  viewElementSource: [ElementAndRendererID],\n\n  // React Native style editor plug-in.\n  NativeStyleEditor_measure: [ElementAndRendererID],\n  NativeStyleEditor_renameAttribute: [NativeStyleEditor_RenameAttributeParams],\n  NativeStyleEditor_setValue: [NativeStyleEditor_SetValueParams],\n\n  // Temporarily support newer standalone front-ends sending commands to older embedded backends.\n  // We do this because React Native embeds the React DevTools backend,\n  // but cannot control which version of the frontend users use.\n  //\n  // Note that nothing in the newer backend actually listens to these events,\n  // but the new frontend still dispatches them (in case older backends are listening to them instead).\n  //\n  // Note that this approach does no support the combination of a newer backend with an older frontend.\n  // It would be more work to support both approaches (and not run handlers twice)\n  // so I chose to support the more likely/common scenario (and the one more difficult for an end user to \"fix\").\n  overrideContext: [OverrideValue],\n  overrideHookState: [OverrideHookState],\n  overrideProps: [OverrideValue],\n  overrideState: [OverrideValue],\n\n  resumeElementPolling: [],\n  pauseElementPolling: [],\n};\n\nclass Bridge<\n  OutgoingEvents: Object,\n  IncomingEvents: Object,\n> extends EventEmitter<{\n  ...IncomingEvents,\n  ...OutgoingEvents,\n}> {\n  _isShutdown: boolean = false;\n  _messageQueue: Array<any> = [];\n  _timeoutID: TimeoutID | null = null;\n  _wall: Wall;\n  _wallUnlisten: Function | null = null;\n\n  constructor(wall: Wall) {\n    super();\n    this._wall = wall;\n\n    this._wallUnlisten =\n      wall.listen((message: Message) => {\n        if (message && message.event) {\n          (this: any).emit(message.event, message.payload);\n        }\n      }) || null;\n\n    // Temporarily support older standalone front-ends sending commands to newer embedded backends.\n    // We do this because React Native embeds the React DevTools backend,\n    // but cannot control which version of the frontend users use.\n    this.addListener('overrideValueAtPath', this.overrideValueAtPath);\n  }\n\n  // Listening directly to the wall isn't advised.\n  // It can be used to listen for legacy (v3) messages (since they use a different format).\n  get wall(): Wall {\n    return this._wall;\n  }\n\n  send<EventName: $Keys<OutgoingEvents>>(\n    event: EventName,\n    ...payload: $ElementType<OutgoingEvents, EventName>\n  ) {\n    if (this._isShutdown) {\n      console.warn(\n        `Cannot send message \"${event}\" through a Bridge that has been shutdown.`,\n      );\n      return;\n    }\n\n    // When we receive a message:\n    // - we add it to our queue of messages to be sent\n    // - if there hasn't been a message recently, we set a timer for 0 ms in\n    //   the future, allowing all messages created in the same tick to be sent\n    //   together\n    // - if there *has* been a message flushed in the last BATCH_DURATION ms\n    //   (or we're waiting for our setTimeout-0 to fire), then _timeoutID will\n    //   be set, and we'll simply add to the queue and wait for that\n    this._messageQueue.push(event, payload);\n    if (!this._timeoutID) {\n      this._timeoutID = setTimeout(this._flush, 0);\n    }\n  }\n\n  shutdown() {\n    if (this._isShutdown) {\n      console.warn('Bridge was already shutdown.');\n      return;\n    }\n\n    // Queue the shutdown outgoing message for subscribers.\n    this.emit('shutdown');\n    this.send('shutdown');\n\n    // Mark this bridge as destroyed, i.e. disable its public API.\n    this._isShutdown = true;\n\n    // Disable the API inherited from EventEmitter that can add more listeners and send more messages.\n    // $FlowFixMe[cannot-write] This property is not writable.\n    this.addListener = function () {};\n    // $FlowFixMe[cannot-write] This property is not writable.\n    this.emit = function () {};\n    // NOTE: There's also EventEmitter API like `on` and `prependListener` that we didn't add to our Flow type of EventEmitter.\n\n    // Unsubscribe this bridge incoming message listeners to be sure, and so they don't have to do that.\n    this.removeAllListeners();\n\n    // Stop accepting and emitting incoming messages from the wall.\n    const wallUnlisten = this._wallUnlisten;\n    if (wallUnlisten) {\n      wallUnlisten();\n    }\n\n    // Synchronously flush all queued outgoing messages.\n    // At this step the subscribers' code may run in this call stack.\n    do {\n      this._flush();\n    } while (this._messageQueue.length);\n\n    // Make sure once again that there is no dangling timer.\n    if (this._timeoutID !== null) {\n      clearTimeout(this._timeoutID);\n      this._timeoutID = null;\n    }\n  }\n\n  _flush: () => void = () => {\n    // This method is used after the bridge is marked as destroyed in shutdown sequence,\n    // so we do not bail out if the bridge marked as destroyed.\n    // It is a private method that the bridge ensures is only called at the right times.\n\n    if (this._timeoutID !== null) {\n      clearTimeout(this._timeoutID);\n      this._timeoutID = null;\n    }\n\n    if (this._messageQueue.length) {\n      for (let i = 0; i < this._messageQueue.length; i += 2) {\n        this._wall.send(this._messageQueue[i], ...this._messageQueue[i + 1]);\n      }\n      this._messageQueue.length = 0;\n\n      // Check again for queued messages in BATCH_DURATION ms. This will keep\n      // flushing in a loop as long as messages continue to be added. Once no\n      // more are, the timer expires.\n      this._timeoutID = setTimeout(this._flush, BATCH_DURATION);\n    }\n  };\n\n  // Temporarily support older standalone backends by forwarding \"overrideValueAtPath\" commands\n  // to the older message types they may be listening to.\n  overrideValueAtPath: OverrideValueAtPath => void = ({\n    id,\n    path,\n    rendererID,\n    type,\n    value,\n  }: OverrideValueAtPath) => {\n    switch (type) {\n      case 'context':\n        this.send('overrideContext', {\n          id,\n          path,\n          rendererID,\n          wasForwarded: true,\n          value,\n        });\n        break;\n      case 'hooks':\n        this.send('overrideHookState', {\n          id,\n          path,\n          rendererID,\n          wasForwarded: true,\n          value,\n        });\n        break;\n      case 'props':\n        this.send('overrideProps', {\n          id,\n          path,\n          rendererID,\n          wasForwarded: true,\n          value,\n        });\n        break;\n      case 'state':\n        this.send('overrideState', {\n          id,\n          path,\n          rendererID,\n          wasForwarded: true,\n          value,\n        });\n        break;\n    }\n  };\n}\n\nexport type BackendBridge = Bridge<BackendEvents, FrontendEvents>;\nexport type FrontendBridge = Bridge<FrontendEvents, BackendEvents>;\n\nexport default Bridge;\n"],"names":["EventEmitter","Map","event","listener","listeners","listenersMap","get","undefined","set","index","indexOf","push","args","length","apply","didThrow","caughtError","clonedListeners","Array","from","i","error","clear","splice","BATCH_DURATION","BRIDGE_PROTOCOL","version","minNpmVersion","maxNpmVersion","currentBridgeProtocol","Bridge","wall","_timeoutID","clearTimeout","_messageQueue","_wall","send","setTimeout","_flush","id","path","rendererID","type","value","wasForwarded","_wallUnlisten","listen","message","emit","payload","addListener","overrideValueAtPath","_isShutdown","console","warn","removeAllListeners","wallUnlisten"],"sourceRoot":""}